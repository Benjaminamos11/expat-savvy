---
import RedSectionHeader from "../common/RedSectionHeader.astro";
import TaxSavingsCalculatorVanilla from "../calculators/TaxSavingsCalculatorVanilla.astro";
---

<section class="py-20 bg-white" id="tax-optimization">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <RedSectionHeader
            title="Advanced Tax Optimization Strategies"
            className="mb-12"
        />

        <div class="prose prose-lg text-gray-700 max-w-none">
            <p class="mb-12 text-xl leading-relaxed">
                The 3rd Pillar is the only vehicle in the Swiss tax code that
                offers a "Triple Tax Advantage": Tax-deductible contributions,
                tax-free growth, and a reduced tax rate on withdrawal. Mastering
                these rules can save you six figures over a lifetime.
            </p>

            <!-- 8.1 Maximizing Deductions -->
            <div class="grid md:grid-cols-2 gap-12 mb-16">
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-4">
                        1. The "Top-Slice" Deduction Effect
                    </h3>
                    <p class="text-sm">
                        Switzerland uses progressive tax rates. The money you
                        earn last is taxed the most. Conversely, the money you
                        deduct comes off the "top stack" of your income.
                    </p>
                    <p class="text-sm mt-4">
                        If you earn CHF 150,000, your top CHF 7,000 might be
                        taxed at 30%, even if your average rate is 20%. By
                        contributing to Pillar 3a, you wipe out that most
                        expensive slice of income.
                    </p>
                    <div
                        class="bg-gray-100 p-4 rounded mt-4 border-l-4 border-gray-400"
                    >
                        <strong>The Golden Rule:</strong> Always contribute before
                        December 31st. If the money lands on January 1st, deduction
                        for the previous year is lost forever.
                    </div>
                </div>

                <div class="bg-red-50 p-8 rounded-xl">
                    <h4 class="font-bold text-red-800 mb-4">
                        Canton Comparison (Approx. Savings on Max Contribution)
                    </h4>
                    <ul class="space-y-3 text-sm">
                        <li
                            class="flex justify-between border-b border-red-100 pb-2"
                        >
                            <span>Geneva / Lausanne (High Tax)</span>
                            <span class="font-bold">~CHF 2,000 - 2,500</span>
                        </li>
                        <li
                            class="flex justify-between border-b border-red-100 pb-2"
                        >
                            <span>Zurich / Bern (Medium Tax)</span>
                            <span class="font-bold">~CHF 1,600 - 2,000</span>
                        </li>
                        <li
                            class="flex justify-between border-b border-red-100 pb-2"
                        >
                            <span>Zug / Schwyz (Low Tax)</span>
                            <span class="font-bold">~CHF 1,100 - 1,400</span>
                        </li>
                    </ul>
                    <p class="text-xs text-gray-500 mt-4">
                        *Estimates for single earner CHF 100k gross.
                    </p>
                </div>
            </div>

            <!-- Calculator Integration -->
            <div class="my-16">
                <h3 class="text-3xl font-bold text-gray-900 mb-8 text-center">
                    Calculate Your Personal Savings
                </h3>
                <TaxSavingsCalculatorVanilla />
            </div>

            <!-- 8.3 Withdrawal Tax Planning -->
            <div class="mb-16">
                <h3 class="text-3xl font-bold text-gray-900 mb-6">
                    2. The "Exit Tax" Strategy
                </h3>
                <p>
                    You don't pay 0% tax when you take the money out. You pay a
                    specific <strong
                        >Capital Withdrawal Tax (Kapitalauszahlungssteuer)</strong
                    >. This is separate from your income tax and typically 1/5th
                    to 1/2 of the normal rate.
                </p>

                <div class="grid md:grid-cols-3 gap-6 mt-8">
                    <div
                        class="border border-gray-200 p-6 rounded-lg text-center hover:shadow-md transition"
                    >
                        <div class="text-4xl mb-2">üèîÔ∏è</div>
                        <h4 class="font-bold mb-2">Relocation Arbitrage</h4>
                        <p class="text-xs text-gray-600">
                            If you move from a high-tax canton (e.g. Vaud) to a
                            low-tax canton (e.g. Schwyz) <em>before</em> you withdraw
                            your capital, you pay the tax rate of your <strong
                                >new</strong
                            > domicile. This can save 50% on the exit bill.
                        </p>
                    </div>
                    <div
                        class="border border-gray-200 p-6 rounded-lg text-center hover:shadow-md transition"
                    >
                        <div class="text-4xl mb-2">ü™ú</div>
                        <h4 class="font-bold mb-2">The "Ladder" Strategy</h4>
                        <p class="text-xs text-gray-600">
                            Progressive tax applies to withdrawals too.
                            Withdrawing CHF 500,000 at once is taxed higher than
                            withdrawing CHF 100,000 five times. <strong
                                >Solution:</strong
                            > Open 5 separate 3a accounts and cash them out in different
                            years (e.g. age 60, 61, 62, 63, 64).
                        </p>
                    </div>
                    <div
                        class="border border-gray-200 p-6 rounded-lg text-center hover:shadow-md transition"
                    >
                        <div class="text-4xl mb-2">üë´</div>
                        <h4 class="font-bold mb-2">Spousal Splitting</h4>
                        <p class="text-xs text-gray-600">
                            Married couples are taxed jointly. If you both
                            withdraw in the same year, your capital stacks up,
                            pushing you into a higher bracket. Coordinate so you
                            withdraw in alternating years.
                        </p>
                    </div>
                </div>
            </div>

            <!-- 8.5 Multi-Year Planning Table -->
            <div class="mb-16">
                <h3 class="text-3xl font-bold text-gray-900 mb-6">
                    The 10-Year Compound Effect
                </h3>
                <div class="overflow-x-auto">
                    <table
                        class="min-w-full text-sm border-collapse border border-gray-200"
                    >
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="p-3 text-left border">Year</th>
                                <th class="p-3 text-left border"
                                    >Contribution</th
                                >
                                <th class="p-3 text-left border text-green-700"
                                    >Tax Saved (@25%)</th
                                >
                                <th class="p-3 text-left border"
                                    >Total Value (Inv @ 5%)</th
                                >
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr
                                ><td class="p-3">Year 1</td><td class="p-3"
                                    >CHF 7,258</td
                                ><td class="p-3 font-bold text-green-700"
                                    >CHF 1,815</td
                                ><td class="p-3">CHF 7,620</td></tr
                            >
                            <tr
                                ><td class="p-3">Year 5</td><td class="p-3"
                                    >CHF 7,258</td
                                ><td class="p-3 font-bold text-green-700"
                                    >CHF 1,815</td
                                ><td class="p-3">CHF 42,100</td></tr
                            >
                            <tr
                                ><td class="p-3">Year 10</td><td class="p-3"
                                    >CHF 7,258</td
                                ><td class="p-3 font-bold text-green-700"
                                    >CHF 1,815</td
                                ><td class="p-3">CHF 95,800</td></tr
                            >
                            <tr class="bg-gray-50 font-bold">
                                <td class="p-3">TOTAL Impact</td>
                                <td class="p-3">CHF 72,580 (cost)</td>
                                <td class="p-3 text-green-700"
                                    >CHF 18,150 (cash back)</td
                                >
                                <td class="p-3">~CHF 96k (Asset)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-xs text-gray-500 mt-2">
                    *Compound growth and tax savings reinvested assumes market
                    performance. Not guaranteed.
                </p>
            </div>
        </div>
    </div>
</section>
