---
// Get current page path to determine context
const currentPath = Astro.url.pathname;

// Determine intent based on URL path
let pageIntent = 'home';
if (currentPath.includes('/setup')) pageIntent = 'setup';
else if (currentPath.includes('/change')) pageIntent = 'change';
else if (currentPath.includes('/cheapest')) pageIntent = 'cheapest';
else if (currentPath.includes('/best')) pageIntent = 'best';
else if (currentPath.includes('/compare')) pageIntent = 'compare';
else if (currentPath.includes('/healthcare/all-insurances/')) pageIntent = 'provider';

const pageSlug = currentPath.split('/').filter(Boolean).pop() || '';
---

<div id="offers-modal" 
    class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50"
    data-page-intent={pageIntent} 
    data-page-slug={pageSlug}
    role="dialog"
    aria-modal="true">
  


  <div class="fixed inset-0 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl max-w-6xl w-full overflow-y-auto max-h-[95vh] relative shadow-2xl transition-all duration-200 scale-100 translate-y-0">

      <!-- Close button -->
      <button id="close-modal-btn" class="absolute top-4 right-4 z-10 p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      
      <!-- Mobile Layout -->
      <div class="lg:hidden pointer-events-auto"> <!-- Enable pointer events -->
        <!-- Progress bar -->
        <div class="h-2 bg-gray-200">
          <div id="mobile-progress-bar" class="h-full bg-red-500 transition-all duration-300" style="width: 0%"></div>
        </div>
        
        <!-- Content -->
        <div id="mobile-content" class="p-6 overflow-y-auto pointer-events-auto" style="max-height: calc(95vh - 80px); min-height: 400px;"> <!-- Remove background: yellow; -->
          <!-- Will be populated by JavaScript -->
        </div>
        
        <!-- Footer -->
        <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4 flex gap-3">
          <button id="mobile-back-btn" class="hidden px-4 py-2 text-gray-600 border border-gray-300 rounded-lg">Back</button>
          <button id="mobile-next-btn" class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg font-semibold">Next â†’</button>
        </div>
      </div>
      
      <!-- Desktop Layout -->
      <div class="hidden lg:block pointer-events-auto" id="desktop-content">
        <!-- Dynamic content will be injected here by JavaScript -->
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Global function to open modal (for compatibility with existing scripts)
  // @ts-ignore
  window.openOffersModal = function() {
    // @ts-ignore
    if (window.globalOffersModal) {
      // @ts-ignore
      window.globalOffersModal.openModal();
    } else {
      // Fallback: directly show modal (should not be needed if script loads properly)
      const modal = document.getElementById('offers-modal');
      if (modal) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    }
  };
  
  // Legacy compatibility
  // @ts-ignore
  window.showConsultationModal = window.openOffersModal;
  // @ts-ignore
  window.openConsultationModal = window.openOffersModal;
});
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  #offers-modal:not(.hidden) {
    animation: fadeIn 0.2s ease-out;
  }
  
  @media (prefers-reduced-motion: reduce) {
    * { animation: none !important; transition: none !important; }
  }

  #offers-modal button {
    pointer-events: auto !important; /* Force enable clicks on buttons */
    user-select: auto;
  }
  #offers-modal .flex {
    pointer-events: auto; /* Enable on flex wrappers */
  }
</style>

<!-- Add Lucide script before our offers-modal.js -->
<script src="https://unpkg.com/lucide@0.244.0/dist/umd/lucide.js"></script>

<!-- Include the OffersModal class logic (loads after Lucide) -->
<script src="/scripts/offers-modal.js?v=1.2.1" defer></script>