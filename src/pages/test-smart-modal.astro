---
import Layout from '../layouts/Layout.astro';
import WorkingSmartModal from '../components/WorkingSmartModal.astro';
---

<Layout
  title="Smart Modal Test | Expat Savvy"
  description="Testing the new Smart Modal with psychological flow"
>
  <div class="container mx-auto max-w-7xl px-4 py-24">
    <div class="text-center max-w-3xl mx-auto">
      <h1 class="text-4xl font-bold mb-6">Smart Modal Test Page</h1>
      <p class="text-lg text-gray-600 mb-12">
        This page tests the new SmartModal with psychological flow optimization.
      </p>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button
          id="open-smart-modal-btn"
          class="inline-flex items-center px-8 py-4 border border-transparent text-lg font-medium rounded-md text-white bg-red-600 hover:bg-red-700 transition-colors duration-300 shadow-lg hover:shadow-xl"
        >
          Open Smart Modal
          <svg class="ml-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
          </svg>
        </button>
        
        <button
          class="inline-flex items-center px-8 py-4 border-2 border-gray-300 text-lg font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors duration-300"
          onclick="console.log('SmartModalManager:', window.SmartModalManager)"
        >
          Check Console
        </button>
      </div>
      
      <div class="mt-12 p-6 bg-gray-50 rounded-lg">
        <h2 class="text-xl font-semibold mb-4">SmartModal Features:</h2>
        <ul class="text-left max-w-2xl mx-auto space-y-2">
          <li>✅ Qualification step with 6 situation cards</li>
          <li>✅ Dynamic routing based on complexity score (high/medium/low value)</li>
          <li>✅ Psychological nudges and social proof</li>
          <li>✅ Clean booking flow with form + Cal.com integration</li>
          <li>✅ Confirmation step with next steps</li>
          <li>✅ Mobile-optimized with proper touch targets</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Include WorkingSmartModal -->
  <WorkingSmartModal />
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('🔍 Test page loaded, checking for SmartModal...');
    
    const openBtn = document.getElementById('open-smart-modal-btn');
    if (openBtn) {
      openBtn.addEventListener('click', function() {
        console.log('🚀 Button clicked, attempting to open SmartModal...');
        
        // Try different modal opening methods
        if (typeof window.openSmartModal === 'function') {
          console.log('✅ openSmartModal function found');
          window.openSmartModal();
        } else if (window.SmartModalManager) {
          console.log('✅ SmartModalManager found, calling open()');
          window.SmartModalManager.open();
        } else {
          console.error('❌ No SmartModal functions found');
          console.log('Available functions:', Object.keys(window).filter(k => k.toLowerCase().includes('modal') || k.toLowerCase().includes('smart')));
          
          // Fallback: directly show modal using DOM
          const modal = document.getElementById('smart-modal');
          if (modal) {
            console.log('📱 Fallback: Opening modal directly via DOM');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            document.body.classList.add('modal-open');
          } else {
            console.error('❌ Modal element #smart-modal not found');
            console.log('Available modal IDs:', Array.from(document.querySelectorAll('[id*="modal"]')).map(el => el.id));
          }
        }
      });
    }
  });
</script>

<style>
  /* Override console.log button styling if needed */
  button {
    cursor: pointer;
  }
</style>

