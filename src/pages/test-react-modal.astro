---
import Layout from '../layouts/Layout.astro';
import FunctionalModal from '../components/FunctionalModal.jsx';
---

<Layout
  title="Functional React Modal Test | Expat Savvy"
  description="Testing the working React modal"
>
  <div class="container mx-auto max-w-7xl px-4 py-24">
    <div class="text-center max-w-3xl mx-auto">
      <h1 class="text-4xl font-bold mb-6">Functional React Modal ✅</h1>
      <p class="text-lg text-gray-600 mb-8">
        This is a simple, working React modal with all core features.
      </p>
      
      <button
        id="open-modal-btn"
        class="bg-red-500 hover:bg-red-600 text-white font-semibold py-4 px-8 rounded-lg shadow-lg transition-colors text-lg"
      >
        Open Modal
      </button>

      <div class="mt-12 p-6 bg-gray-50 rounded-lg text-left">
        <h2 class="text-xl font-semibold mb-4">✅ Features:</h2>
        <ul class="space-y-2">
          <li>✓ Step 1: Qualification (6 situations)</li>
          <li>✓ Step 2: Value demo (routes by complexity)</li>
          <li>✓ Step 3: Booking form (name, email, phone)</li>
          <li>✓ Step 4: Calendar embed (Cal.com ready)</li>
          <li>✓ Step 5: Confirmation with next steps</li>
          <li>✓ Robert's photo + credentials on every step</li>
          <li>✓ Clean, corporate design</li>
          <li>✓ Fully responsive mobile/desktop</li>
          <li>✓ ESC key to close</li>
          <li>✓ Backdrop click to close</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- React Modal Component -->
  <div id="react-modal-root"></div>

  <FunctionalModal client:only="react" />
</Layout>

<script>
  import { createRoot } from 'react-dom/client';
  import { createElement } from 'react';
  
  document.addEventListener('DOMContentLoaded', () => {
    console.log('🚀 Test page loaded');
    
    const openBtn = document.getElementById('open-modal-btn');
    const modalRoot = document.getElementById('react-modal-root');
    
    if (!modalRoot) {
      console.error('❌ Modal root not found');
      return;
    }

    let isOpen = false;
    let root = null;

    const updateModal = (open) => {
      isOpen = open;
      
      if (!root) {
        root = createRoot(modalRoot);
      }

      // Import the modal component dynamically
      import('../components/FunctionalModal.jsx').then((module) => {
        const FunctionalModal = module.default;
        root.render(
          createElement(FunctionalModal, {
            isOpen: isOpen,
            onClose: () => updateModal(false),
            pageIntent: 'home'
          })
        );
      });
    };

    if (openBtn) {
      openBtn.addEventListener('click', () => {
        console.log('✅ Opening modal');
        updateModal(true);
      });
    }
  });
</script>


